local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local THRESHOLD = 0.8
local currentHumanoid = nil
local staminaBar = nil
local canAct = false  -- Ban đầu không cho phép hành động
local initialDelay = 30  -- Thời gian delay 30 giây khi bắt đầu script

local function setupCharacter(character)
    currentHumanoid = character:WaitForChild("Humanoid")
    staminaBar = player:WaitForChild("PlayerGui"):WaitForChild("UI"):WaitForChild("HUD"):WaitForChild("Bars"):WaitForChild("Stamina")
end

if player.Character then
    setupCharacter(player.Character)
end

player.CharacterAdded:Connect(setupCharacter)

-- Đợi 30 giây trước khi cho phép script hoạt động
task.wait(initialDelay)
canAct = true  -- Sau khi 30 giây, bật lại khả năng hành động

RunService.RenderStepped:Connect(function()
    if currentHumanoid and staminaBar then
        local percent = staminaBar.Size.X.Scale
        if percent < THRESHOLD and currentHumanoid.Health > 0 and canAct then
            -- Khi mana thấp và nhân vật có thể reset
            currentHumanoid.Health = 0  -- Nhân vật chết (reset)
            canAct = false  -- Tắt khả năng hành động

            -- Chờ 30 giây trước khi cho phép nhân vật hành động lại
            task.wait(30)
            
            canAct = true  -- Mở lại khả năng hành động sau 30 giây
        end
    end
end)
