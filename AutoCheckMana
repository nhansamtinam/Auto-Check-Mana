local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local VirtualInputManager = game:GetService("VirtualInputManager")

local player = Players.LocalPlayer
local THRESHOLD = 0.1
local currentHumanoid = nil
local staminaBar = nil
local canAct = false  -- Ban Ä‘áº§u khÃ´ng cho phÃ©p hÃ nh Ä‘á»™ng
local initialDelay = 30  -- Thá»i gian delay 30 giÃ¢y khi báº¯t Ä‘áº§u script

-- ğŸ” HÃ m mÃ´ phá»ng Reset nhÃ¢n váº­t (Esc + R + Enter)
local function simulateResetCharacter()
    -- Má»Ÿ menu ESC
    VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Escape, false, game)
    task.wait(0.2)
    VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Escape, false, game)

    -- Nháº¥n R Ä‘á»ƒ chá»n Reset Character
    task.wait(0.5)
    VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.R, false, game)
    task.wait(0.1)
    VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.R, false, game)

    -- Nháº¥n Enter Ä‘á»ƒ xÃ¡c nháº­n Reset
    task.wait(0.5)
    VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Return, false, game)
    task.wait(0.1)
    VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Return, false, game)
end

-- ğŸ” GÃ¡n láº¡i nhÃ¢n váº­t má»—i khi respawn
local function setupCharacter(character)
    currentHumanoid = character:WaitForChild("Humanoid")
    staminaBar = player:WaitForChild("PlayerGui"):WaitForChild("UI"):WaitForChild("HUD"):WaitForChild("Bars"):WaitForChild("Stamina")
end

-- Náº¿u nhÃ¢n váº­t Ä‘Ã£ tá»“n táº¡i
if player.Character then
    setupCharacter(player.Character)
end

-- Khi nhÃ¢n váº­t má»›i spawn láº¡i
player.CharacterAdded:Connect(function(char)
    setupCharacter(char)
end)

-- â³ Delay 30 giÃ¢y khi báº¯t Ä‘áº§u
task.wait(initialDelay)
canAct = true

-- ğŸ”„ Theo dÃµi Stamina vÃ  reset khi cáº§n
RunService.RenderStepped:Connect(function()
    if currentHumanoid and staminaBar then
        local percent = staminaBar.Size.X.Scale
        if percent < THRESHOLD and currentHumanoid.Health > 0 and canAct then
            -- Náº¿u Stamina tháº¥p vÃ  cÃ³ thá»ƒ reset
            simulateResetCharacter()  -- MÃ´ phá»ng Reset báº±ng phÃ­m
            canAct = false  -- Táº¯t kháº£ nÄƒng hÃ nh Ä‘á»™ng

            -- Chá» 30 giÃ¢y trÆ°á»›c khi reset láº§n tiáº¿p theo
            task.wait(30)
            canAct = true
        end
    end
end)
